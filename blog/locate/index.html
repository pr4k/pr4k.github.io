<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Locate:  A Recurive Search Tool - RUST :: Blog</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="How many times have you gone through files to find some string or origin of a function
Locate is a tool written in Rust which goes through each file recursively and gives exact location of the query string in the files.
Its blazing fast, as its written in Rust, and can recursively walk the directories.
 Motivation Okay so I wanted to learn Rust and I think the best way to learn a new language is by creating a project, I always used search function in VS code to find origin of a function or places where the function is used."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/blog/locate/" />





<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">



<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Locate:  A Recurive Search Tool - RUST"/>
<meta name="twitter:description" content="How many times have you gone through files to find some string or origin of a function
Locate is a tool written in Rust which goes through each file recursively and gives exact location of the query string in the files.
Its blazing fast, as its written in Rust, and can recursively walk the directories.
 Motivation Okay so I wanted to learn Rust and I think the best way to learn a new language is by creating a project, I always used search function in VS code to find origin of a function or places where the function is used."/>



<meta property="og:title" content="Locate:  A Recurive Search Tool - RUST" />
<meta property="og:description" content="How many times have you gone through files to find some string or origin of a function
Locate is a tool written in Rust which goes through each file recursively and gives exact location of the query string in the files.
Its blazing fast, as its written in Rust, and can recursively walk the directories.
 Motivation Okay so I wanted to learn Rust and I think the best way to learn a new language is by creating a project, I always used search function in VS code to find origin of a function or places where the function is used." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/locate/" />
<meta property="article:published_time" content="2020-03-21T00:31:05+00:00" />
<meta property="article:modified_time" content="2020-03-21T00:31:05+00:00" /><meta property="og:site_name" content="Blog" />





<link rel="stylesheet" type="text/css" href="/css/custom.css">


<link rel="stylesheet" type="text/css" href="/css/variables.css" />



  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
	href="/"
	class="logo"
	style="text-decoration: none;"
>


	
	<span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
	<span class="logo__text"
    > locate
    </span
	>
	<span class="logo__cursor"></span>
	
</a>
    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/blog">Blog</a></li>
        
      
        
          <li><a href="/projects">Projects</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/blog">Blog</a></li>
      
    
      
        <li><a href="/projects">Projects</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path  d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h2 class="post-title"><a href="/blog/locate/">Locate:  A Recurive Search Tool - RUST</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
          2020-03-21
        </span>

        
          
        
      

      
      
        <span class="post-read-time">— 5 min read</span>
      
    </div>

    

    
      
        <img src="/img/locate.png" class="post-cover" />
      
    

    <div class="post-content">
      <p>How many times have you gone through files to find some string or origin of a function</p>
<p>Locate is a tool written in Rust which goes through each file recursively and gives exact location of the query string in the files.</p>
<p>Its blazing fast, as its written in Rust, and can recursively walk the directories.</p>
<hr>
<h2 id="motivation">Motivation</h2>
<p>Okay so I wanted to learn Rust and I think the best way to learn a new language is by creating a project,
I always used search function in VS code to find origin of a function or places where the function is used.</p>
<p>If working with large projects it sometimes becomes difficult to exactly locate all the points where a function is used, ofcourse one can follow the imports to trace back to origin of function but having a tool can be handy sometimes.</p>
<p><em>Note:- As this is my first project in Rust, so its a possibility that I have done certain things differently than it should be</em></p>
<p>So lets start</p>
<hr>
<h2 id="create-a-new-package">Create A New Package:</h2>
<p>For starting a new package we do <code>cargo new</code>, as this is a binary program so</p>
<p><code>cargo new locate --bin</code></p>
<p>This creates a folder structure like</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">.
├── Cargo.toml
└── src
    └── main.rs

<span style="color:#ae81ff">1</span> directory, <span style="color:#ae81ff">2</span> files
</code></pre></div><hr>
<h2 id="packages-we-need">Packages We Need:</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">fstream <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0.1.2&#34;</span>
walkdir <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2.3.1&#34;</span>
argparse <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0.2.2&#34;</span>
colored <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1.9&#34;</span>
</code></pre></div><ul>
<li><strong>fstream</strong>: It will be used to read file</li>
<li><strong>walkdir</strong>: This will be used to iterate over all the folders and files</li>
<li><strong>argparse</strong>: Its a simple argparser to parse arguments</li>
<li><strong>colored</strong>: Will be used to colorize the terminal output</li>
</ul>
<p>Add these to your <code>cargo.toml</code>:</p>
<p>Now our <em>cargo.toml</em> will look something like</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[<span style="color:#a6e22e">package</span>]
<span style="color:#a6e22e">name</span> = <span style="color:#e6db74">&#34;locate&#34;</span>
<span style="color:#a6e22e">version</span> = <span style="color:#e6db74">&#34;0.1.0&#34;</span>
<span style="color:#a6e22e">authors</span> = [<span style="color:#e6db74">&#34;Prakhar &lt;b118038@iiit-bh.ac.in&gt;&#34;</span>]
<span style="color:#a6e22e">description</span> = <span style="color:#e6db74">&#34;A tool to search all the occurrences of a string in all the files in directory&#34;</span>
<span style="color:#a6e22e">readme</span> = <span style="color:#e6db74">&#34;README.md&#34;</span>
<span style="color:#a6e22e">repository</span> = <span style="color:#e6db74">&#34;https://github.com/pr4k/locate&#34;</span>
<span style="color:#a6e22e">license</span><span style="color:#960050;background-color:#1e0010">-</span><span style="color:#a6e22e">file</span> = <span style="color:#e6db74">&#34;LICENSE&#34;</span>
<span style="color:#a6e22e">keywords</span> = [<span style="color:#e6db74">&#34;cli&#34;</span>,<span style="color:#e6db74">&#34;search&#34;</span>,<span style="color:#e6db74">&#34;rust&#34;</span>]
<span style="color:#a6e22e">edition</span> = <span style="color:#e6db74">&#34;2020&#34;</span>

<span style="color:#75715e"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span>

[<span style="color:#a6e22e">dependencies</span>]
<span style="color:#a6e22e">fstream</span> = <span style="color:#e6db74">&#34;0.1.2&#34;</span>
<span style="color:#a6e22e">walkdir</span> = <span style="color:#e6db74">&#34;2.3.1&#34;</span>
<span style="color:#a6e22e">argparse</span> = <span style="color:#e6db74">&#34;0.2.2&#34;</span>
<span style="color:#a6e22e">colored</span> = <span style="color:#e6db74">&#34;1.9&#34;</span>

</code></pre></div><hr>
<h2 id="main-code">Main Code:</h2>
<p>Our basic workflow will be first we will take <code>path</code> and <code>query</code> from user.
Then we need a function to iterate over all the folders in the path and check whether the query string is present in any file ,
If so the path of file will be passed to another function where the exact location of query string will be located.</p>
<p>Walking directory is easy as we will be using <code>walkdir</code> for that.</p>
<h3 id="code-for-checking-dir">Code for <code>checking dir</code>:</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">check_dir</span>(path: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span>, query: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span>) {
    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> total_files_scanned <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">for</span> (fl_no, e) <span style="color:#66d9ef">in</span> WalkDir::new(path)
        .into_iter()
        .filter_map(<span style="color:#f92672">|</span>e<span style="color:#f92672">|</span> e.ok())
        .enumerate()
    {
        <span style="color:#66d9ef">if</span> e.metadata().unwrap().is_file() {
            <span style="color:#66d9ef">match</span> fstream::contains(e.path(), query) {
                Some(b) <span style="color:#f92672">=&gt;</span> {
                    <span style="color:#66d9ef">if</span> b {
                        check_file(e.path(), query);
                    }
                }
                None <span style="color:#f92672">=&gt;</span> println<span style="color:#f92672">!</span>(<span style="color:#e6db74">&#34;Error in walking Dir&#34;</span>),
            }
        }
        total_files_scanned <span style="color:#f92672">=</span> fl_no;
    }

    println<span style="color:#f92672">!</span>(
        <span style="color:#e6db74">&#34;Total Scanned files {}&#34;</span>,
        total_files_scanned.to_string().bold()
    );
}
</code></pre></div><p>We create a new Walkdir on the path given and <strong>apply a filter</strong> to silence the permission error.</p>
<p>Next we check if the iter is a file then we are using <code>fstrem</code> to check whther the query string is in the file or not.</p>
<p>Once we get the file having query, its passed to another function which locates the exact line number.</p>
<h3 id="code-for-checking-file">Code for <em>Checking file</em>:</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">check_file</span>(file_path: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">Path</span>, query: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span>) {
    println<span style="color:#f92672">!</span>(
        <span style="color:#e6db74">&#34;In file {}\n&#34;</span>,
        file_path.display().to_string().magenta().italic()
    );
    <span style="color:#66d9ef">match</span> fstream::read_lines(file_path) {
        Some(s) <span style="color:#f92672">=&gt;</span> {
            <span style="color:#66d9ef">for</span> (pos, s) <span style="color:#66d9ef">in</span> s.iter().enumerate() {
                <span style="color:#66d9ef">if</span> s.contains(query) {
                    print<span style="color:#f92672">!</span>(<span style="color:#e6db74">&#34;{}&#34;</span>, <span style="color:#e6db74">&#34;Line &#34;</span>.green().bold());
                    print<span style="color:#f92672">!</span>(<span style="color:#e6db74">&#34;{0: &lt;6} &#34;</span>, pos.to_string().cyan());
                    println<span style="color:#f92672">!</span>(<span style="color:#e6db74">&#34;=&gt; {}&#34;</span>, s.trim().blue());
                }
            }
        }
        None <span style="color:#f92672">=&gt;</span> println<span style="color:#f92672">!</span>(<span style="color:#e6db74">&#34;Error in reading File&#34;</span>),
    }
    println<span style="color:#f92672">!</span>(<span style="color:#e6db74">&#34;&#34;</span>);
}
</code></pre></div><p>Its simple, we are reading the whole file <strong>line by line</strong> and as it returns a string vector, we can easily iterate over each line and check if the query string is present or not.</p>
<p>If present we are simply printing it, There is formatting for print, like <code>.green()</code>, <code>.bold()</code> etc which is done with the help of <code>colored</code> crate we imported earlier.</p>
<p>That&rsquo;s all, we have code for both part, reading file and finding file.</p>
<p>What&rsquo;s left is to parse arguments from command line. The library argparser is inspired by <code>argparse</code> in python.</p>
<h3 id="code-for-argpase">Code for <em>Argpase</em></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;.&#34;</span>.to_string();
    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;query&#34;</span>.to_string();
    {
        <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> ap <span style="color:#f92672">=</span> ArgumentParser::new();
        ap.set_description(<span style="color:#e6db74">&#34;Recursive string locater in files&#34;</span>);
        ap.refer(<span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> path)
            .add_option(<span style="color:#f92672">&amp;</span>[<span style="color:#e6db74">&#34;-p&#34;</span>, <span style="color:#e6db74">&#34;--path&#34;</span>], Store, <span style="color:#e6db74">&#34;Path to folder&#34;</span>);
        ap.refer(<span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> query)
            .add_option(<span style="color:#f92672">&amp;</span>[<span style="color:#e6db74">&#34;-q&#34;</span>, <span style="color:#e6db74">&#34;--query&#34;</span>], Store, <span style="color:#e6db74">&#34;Query string to find&#34;</span>)
            .required();
        ap.parse_args_or_exit();
    }
    println<span style="color:#f92672">!</span>(
        <span style="color:#e6db74">&#34;Searching &#39;{}&#39; in {}\n&#34;</span>,
        query.green().bold(),
        path.italic()
    );
    check_dir(<span style="color:#f92672">&amp;</span>path, <span style="color:#f92672">&amp;</span>query);
}
</code></pre></div><p>It is also pretty simple, we are creating two mutable varibale <em>(Variable in rust are by default immutable)</em>, then we will be creating a new Argpaser  object, set its description and create our options. The best thing is, it automatically generates the help message using our description for each option.</p>
<p>Done, Lets try it !!</p>
<p>Type <code>cargo build</code> You will find a binary created in <code>target/debug</code>,
You can run it directly by <code>cargo run</code> or using the binary you just created.</p>
<hr>
<h3 id="demo">DEMO</h3>
<p><img src="demo.gif" alt="demo"></p>
<p>You can find the whole <strong>source code at <a href="https://github.com/pr4k/locate/">Github@pr4k/locate</a></strong></p>
<p>Also if you don&rsquo;t want to do all this, you can install it directly using
<code>cargo install locate</code></p>
<p>or checkout at <a href="https://crates.io/crates/locate">cargo@locate</a></p>
<p>Thanks for Reading
Happy Coding</p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
          </div>
          <div class="pagination__buttons">
            
            
              <span class="button next">
                <a href="/blog/hugo-to-medium/">
                  <span class="button__text">Hugo to Medium</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    


    
      
        

      
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">© 2020 Powered by Hugo | Theme Customized by pr4k</div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
