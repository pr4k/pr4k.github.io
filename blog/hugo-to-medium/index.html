<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Hugo to Medium :: Blog</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Photo by Yancy Min on Unsplash Motivation So everytime I added a blog on my personal website (Which is very rare) I had to go to my medium profile and import it manually. So once I got to know about Github actions, the first idea was to automate this process. Also this project was an attempt to understand Github Actions better.
Description So what our action does is everytime I push my code to the github Repo with a special commit message, it takes the new post and use the Medium API and creates a new draft at my medium account."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/blog/hugo-to-medium/" />





<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">



<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Hugo to Medium"/>
<meta name="twitter:description" content="Photo by Yancy Min on Unsplash Motivation So everytime I added a blog on my personal website (Which is very rare) I had to go to my medium profile and import it manually. So once I got to know about Github actions, the first idea was to automate this process. Also this project was an attempt to understand Github Actions better.
Description So what our action does is everytime I push my code to the github Repo with a special commit message, it takes the new post and use the Medium API and creates a new draft at my medium account."/>



<meta property="og:title" content="Hugo to Medium" />
<meta property="og:description" content="Photo by Yancy Min on Unsplash Motivation So everytime I added a blog on my personal website (Which is very rare) I had to go to my medium profile and import it manually. So once I got to know about Github actions, the first idea was to automate this process. Also this project was an attempt to understand Github Actions better.
Description So what our action does is everytime I push my code to the github Repo with a special commit message, it takes the new post and use the Medium API and creates a new draft at my medium account." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/hugo-to-medium/" />
<meta property="article:published_time" content="2020-03-09T02:12:45+00:00" />
<meta property="article:modified_time" content="2020-03-09T02:12:45+00:00" /><meta property="og:site_name" content="Blog" />





<link rel="stylesheet" type="text/css" href="/css/custom.css">


<link rel="stylesheet" type="text/css" href="/css/variables.css" />



  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
	href="/"
	class="logo"
	style="text-decoration: none;"
>


	
	<span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
	<span class="logo__text"
    > hugo-to-medium
    </span
	>
	<span class="logo__cursor"></span>
	
</a>
    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/blog">Blog</a></li>
        
      
        
          <li><a href="/projects">Projects</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/blog">Blog</a></li>
      
    
      
        <li><a href="/projects">Projects</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path  d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h2 class="post-title"><a href="/blog/hugo-to-medium/">Hugo to Medium</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
          2020-03-09
        </span>

        
          
        
      

      
      
        <span class="post-read-time">— 5 min read</span>
      
    </div>

    

    
      
        <img src="/img/hugo-to-medium.jpg" class="post-cover" />
      
    

    <div class="post-content">
      <h6 id="photo-by-yancy-min-on-unsplash"><em>Photo by Yancy Min on Unsplash</em></h6>
<h2 id="motivation">Motivation</h2>
<p>So everytime I added a blog on my personal website (Which is very rare) I had to go to my medium profile and import it manually. So once I got to know about Github actions, the first idea was to automate this process. Also this project was an attempt to understand Github Actions better.</p>
<h2 id="description">Description</h2>
<p>So what our action does is everytime I push my code to the github Repo with a special commit message, it takes the new post and use the Medium API and creates a new draft at my medium account.</p>
<p>Okay so lets get into it.</p>
<h2 id="development">Development</h2>
<p>So first of all let me clear some things out, As this was my first GitHub Action, I had no idea about how this all integrates. It took me time before it all started making sense, so what I will suggest is, if someone is creating it for the first time you can create 2 repository one for your action and second for testing that action.</p>
<p>The <a href="https://help.github.com/en/actions/building-actions/creating-a-docker-container-action">Official Setup guide</a> is good but still it was a bit confusing for me as the Docker container example is very simple and covers just a Hello World type example.</p>
<p>Before we start, please read how to setup the environment variables in Github, and also generate your APP_ID , APP_SECRET, and ACCESS_TOKEN from <a href="https://medium.com/me/applications">Medium applications</a> and <a href="https://medium.com/me/settings">Medium setting</a></p>
<h3 id="create-actionyml">Create Action.yml</h3>
<p>So first lets see the code</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#75715e"># action.yml</span>
<span style="color:#f92672">name</span>: <span style="color:#e6db74">&#39;Hugo to Medium&#39;</span>
<span style="color:#f92672">description</span>: <span style="color:#e6db74">&#39;Pushes your blog from hugo to medium&#39;</span> 
<span style="color:#f92672">runs</span>:
  <span style="color:#f92672">using</span>: <span style="color:#e6db74">&#39;docker&#39;</span>
  <span style="color:#f92672">image</span>: <span style="color:#e6db74">&#39;Dockerfile&#39;</span>
<span style="color:#f92672">branding</span>:
  <span style="color:#f92672">icon</span>: <span style="color:#e6db74">&#39;aperture&#39;</span>
  <span style="color:#f92672">color</span>: <span style="color:#e6db74">&#39;gray-dark&#39;</span>
<span style="color:#ae81ff">Okay so its pretty simple </span>
</code></pre></div><p><code>name</code>: The name of our action</p>
<p><code>description</code>: The normal description of our action</p>
<p><code>runs</code>: This is where it starts, Basically it uses our DockerFile and spawns it.</p>
<p><code>branding</code>: This is just a normal branding which will be used at the market place</p>
<h2 id="create-dockerfile">Create DockerFile</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Docker" data-lang="Docker"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> python:3.7.2-alpine3.9</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> apk add --no-cache <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    jq <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    curl <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    git <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    python<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> apk add --no-cache python3-dev libstdc++ <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    apk add --no-cache g++ <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    ln -s /usr/include/locale.h /usr/include/xlocale.h <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    pip3 install medium <span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ADD</span> entrypoint.sh /<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ADD</span> post.py /<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> chmod +x /post.py<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> chmod +x /entrypoint.sh<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENTRYPOINT</span> [<span style="color:#e6db74">&#34;/entrypoint.sh&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Okay so our docker file will be using a python alpine image
then it will install the required Modules.
Then we will be installing Medium library which will be later used to provide an interface between medium and our project.</p>
<p>Then it will Copy our  <code>entrypoint.sh</code> and <code>post.py</code> and then finally the Entrypoint defines the script which will run first.</p>
<h2 id="create-entrypointsh">Create entrypoint.sh</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/sh -l
</span><span style="color:#75715e"></span>
main<span style="color:#f92672">(){</span>
    message<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>jq  <span style="color:#e6db74">&#39;.commits[0].message&#39;</span> <span style="color:#e6db74">&#34;</span>$GITHUB_EVENT_PATH<span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span>
    python /post.py $message
<span style="color:#f92672">}</span>
main
</code></pre></div><p>Okay so this is simple, basically it finds our latest github commit message and send it to our <code>post.py</code> script.
We can easily do it by using python as later we will be needing python, but for some reason I wanted to use bash to traverse a json file and to be honest, it was good, so if anyone wants to read the docuentation for it. <a href="https://stedolan.github.io/jq/tutorial/">Here it is</a></p>
<p>The <code>$GITHUB_EVENT_PATH</code> stores path for the json file which stores the information about out repo like commits, owners etc.</p>
<h2 id="create-postpy">Create post.py</h2>
<p>So lets see the code for posting it to Medium.
We will be using Environment variables mentioned at the start. The <code>BLOG_DIR</code> is the directory where your blogs are posted.</p>
<p>For example <code>content\blog</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> sys

<span style="color:#f92672">from</span> medium <span style="color:#f92672">import</span> Client

ENV <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">postToMedium</span>(heading,body):
    client <span style="color:#f92672">=</span> Client(application_id <span style="color:#f92672">=</span> ENV[<span style="color:#e6db74">&#34;APP_ID&#34;</span>],application_secret <span style="color:#f92672">=</span> ENV[<span style="color:#e6db74">&#34;APP_SECRET&#34;</span>])

    client<span style="color:#f92672">.</span>access_token <span style="color:#f92672">=</span> ENV[<span style="color:#e6db74">&#34;ACCESS_TOKEN&#34;</span>]

    user <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>get_current_user()

    post <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>create_post(user_id <span style="color:#f92672">=</span> user[<span style="color:#e6db74">&#34;id&#34;</span>], title <span style="color:#f92672">=</span> heading, content <span style="color:#f92672">=</span> body, content_format <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;markdown&#34;</span>, publish_status <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;draft&#34;</span>)

    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;New!! post at &#34;</span>,post[<span style="color:#e6db74">&#34;url&#34;</span>])

commit_msg <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">.</span>join(sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>:])
blog_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(ENV[<span style="color:#e6db74">&#34;GITHUB_WORKSPACE&#34;</span>],ENV[<span style="color:#e6db74">&#34;BLOG_DIR&#34;</span>])
blog_dir <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>listdir(blog_path)
<span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;PUBLISH&#34;</span> <span style="color:#f92672">in</span> commit_msg<span style="color:#f92672">.</span>upper():
    post_name <span style="color:#f92672">=</span> commit_msg<span style="color:#f92672">.</span>upper()<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;PUBLISH&#34;</span>)[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>strip()[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> blog_dir:
        <span style="color:#66d9ef">if</span> post_name <span style="color:#f92672">==</span> i<span style="color:#f92672">.</span>upper()<span style="color:#f92672">.</span>strip():
            post_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(blog_path,i)
            body <span style="color:#f92672">=</span> open(post_path,<span style="color:#e6db74">&#34;r&#34;</span>)<span style="color:#f92672">.</span>read()
            postToMedium(i,body)
</code></pre></div><p>Okay so the code is simple it takes all the Environment variables and also take the commit message which is passed from <code>entrypoint.sh</code> .</p>
<p>It checks whether the commit message contains <code>PUBLISH</code> if yes then we go on matching it from all the files in the blog directory. Once it finds the blog name given in commit message it takes the file and send it to our function which will handle the medium part.</p>
<p>The medium part is simple , its taken from the medium&rsquo;s official documentation. So its pretty self explanatory,
It takes APP_ID and APP_SECRET from environment variables to create our client, then it takes ACCESS_TOKEN from the environment, next we get the user details and use the user id to create the post ,</p>
<p>The title for our post is file name right now .
we are sending the code in Markdown format as our hugo blog is in markdown.
And done that&rsquo;s it our post is uploaded to the medium profile.</p>
<p>But wait a minute!! what about those join splits strips .
Okay so everything I said above is the how the things should go, honestly at one point my Github action log was showing something like ,</p>
<p><code>Post.MD == Post.MD =&gt; False</code> , after 30 mins of testing and modification I got to know that the length of both the string is different because there were empty spaces , So that&rsquo;s why we need to strip them,</p>
<p>Other then that join is just to convert the list of string to a string and split is to get the content after the tage in our commit message PUBLISH.</p>
<h2 id="sample-mainyml">Sample main.yml</h2>
<p>Lets see a sample <code>main.yml</code> for setting it up in our personal projects.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">on</span>: [<span style="color:#ae81ff">push]</span>

<span style="color:#f92672">jobs</span>:
  <span style="color:#f92672">hugo_to_medium_job</span>:
    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">hugo-to-medium</span>
    <span style="color:#f92672">steps</span>:
      - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v2</span>
        <span style="color:#f92672">with</span>:
          <span style="color:#f92672">ref</span>: <span style="color:#ae81ff">master</span>
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Hugo To medium Action step </span>
        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">pr4k/Hugo-to-Medium@master # Uses an action in the root directory</span>
        <span style="color:#f92672">id</span>: <span style="color:#ae81ff">hello</span>
        <span style="color:#f92672">env</span>:
          <span style="color:#f92672">APP_ID</span>: <span style="color:#ae81ff">${{secrets.APP_ID}}</span>
          <span style="color:#f92672">ACCESS_TOKEN</span>: <span style="color:#ae81ff">${{secrets.ACCESS_TOKEN}}</span>
          <span style="color:#f92672">APP_SECRET</span>: <span style="color:#ae81ff">${{secrets.APP_SECRET}}</span>
          <span style="color:#f92672">BLOG_DIR</span>: <span style="color:#ae81ff">${{secrets.BLOG_DIR}}</span>
</code></pre></div><p>We are using Checkout Action because we will be requiring our Repo content in the Docker file, then I am calling my Action from Master branch.</p>
<p>Paste this into <code>.github/workflows/</code> and done</p>
<p>You can find the full source code at <a href="https://github.com/pr4k/hugo-to-medium">@pr4k/Hugo-To-Medium</a>
Thanks For reading.</p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="/blog/locate/">
                  <span class="button__icon">←</span>
                  <span class="button__text">Locate:  A Recurive Search Tool - RUST</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="/blog/archsetup/">
                  <span class="button__text">My Arch Setup</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    


    
      
        

      
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">© 2020 Powered by Hugo | Theme Customized by pr4k</div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
